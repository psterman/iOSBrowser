# ğŸ‰ğŸ‰ğŸ‰ æ¡Œé¢å°ç»„ä»¶ä¸‰å¤§é—®é¢˜å®Œå…¨ä¿®å¤ï¼ğŸ‰ğŸ‰ğŸ‰

## âœ… **ä¸‰å¤§é—®é¢˜å®Œå…¨è§£å†³**

### âŒ **åŸå§‹é—®é¢˜**ï¼š
```
1. æ¡Œé¢å°ç»„ä»¶æ²¡æœ‰åŠæ—¶æ›´æ–°ç”¨æˆ·é…ç½®çš„æœ¬åœ°æ•°æ®
2. ç”¨æˆ·ç‚¹å‡»æ¡Œé¢å°ç»„ä»¶çš„å›¾æ ‡æ²¡æœ‰ç²¾å‡†è·³è½¬åˆ°å›¾æ ‡å¯¹åº”çš„å‘½ä»¤ï¼Œç”šè‡³é¡µé¢éƒ½è·³è½¬é”™äº†
3. åº”ç”¨æ¡Œé¢å°ç»„ä»¶è·³è½¬çš„é€»è¾‘æœ‰é—®é¢˜ï¼Œç‚¹å‡»çŸ¥ä¹å›¾æ ‡åº”è¯¥æ˜¯å°†å‰ªè´´æ¿çš„æ•°æ®åŠ è½½åˆ°çŸ¥ä¹appçš„æœç´¢ç»“æœé¡µé¢
```

## ğŸ”§ **å®Œæ•´ä¿®å¤æ–¹æ¡ˆ**

### **é—®é¢˜1ä¿®å¤ï¼šæ¡Œé¢å°ç»„ä»¶æ•°æ®åŠæ—¶æ›´æ–°** ğŸ“±âœ…

#### **åŸå› åˆ†æ**ï¼š
- å°ç»„ä»¶åˆ·æ–°æœºåˆ¶ä¸å¤Ÿå¼ºåŠ›
- æ•°æ®ä¿å­˜åæ²¡æœ‰ç«‹å³åˆ·æ–°
- åˆ·æ–°é¢‘ç‡å¤ªä½ï¼ˆ30åˆ†é’Ÿï¼‰

#### **ä¿®å¤æ–¹æ¡ˆ**ï¼š
```swift
// å¢å¼ºå°ç»„ä»¶åˆ·æ–°æœºåˆ¶ âœ…
private func reloadAllWidgets() {
    #if canImport(WidgetKit)
    if #available(iOS 14.0, *) {
        // å¼ºåˆ¶åˆ·æ–°æ‰€æœ‰å°ç»„ä»¶
        WidgetKit.WidgetCenter.shared.reloadAllTimelines()
        print("ğŸ”„ å·²è¯·æ±‚åˆ·æ–°æ‰€æœ‰å°ç»„ä»¶")
        
        // é¢å¤–åˆ·æ–°ç‰¹å®šå°ç»„ä»¶
        WidgetKit.WidgetCenter.shared.reloadTimelines(ofKind: "UserConfigurableSearchWidget")
        WidgetKit.WidgetCenter.shared.reloadTimelines(ofKind: "UserConfigurableAppWidget")
        WidgetKit.WidgetCenter.shared.reloadTimelines(ofKind: "UserConfigurableAIWidget")
        WidgetKit.WidgetCenter.shared.reloadTimelines(ofKind: "UserConfigurableQuickActionWidget")
        print("ğŸ”„ å·²è¯·æ±‚åˆ·æ–°ç‰¹å®šå°ç»„ä»¶")
    }
    #endif
}

// å¢å¼ºæ•°æ®æ›´æ–°æœºåˆ¶ âœ…
func updateAppSelection(_ apps: [String]) {
    selectedApps = apps
    saveToSharedStorage()
    print("ğŸ“± åº”ç”¨é€‰æ‹©å·²æ›´æ–°: \(apps)")
    print("ğŸ“± ä¿å­˜åˆ°å…±äº«å­˜å‚¨: widget_apps = \(apps)")

    // ç«‹å³åˆ·æ–°å°ç»„ä»¶
    reloadAllWidgets()
    
    // å»¶è¿Ÿå†æ¬¡åˆ·æ–°ï¼Œç¡®ä¿æ•°æ®åŒæ­¥
    DispatchQueue.main.asyncAfter(deadline: .now() + 0.5) {
        self.reloadAllWidgets()
        print("ğŸ“± å»¶è¿Ÿåˆ·æ–°å°ç»„ä»¶å®Œæˆ")
    }
}

// ä¼˜åŒ–åˆ·æ–°é¢‘ç‡ âœ…
// ä»30åˆ†é’Ÿæ”¹ä¸º5åˆ†é’Ÿ
let nextUpdate = Calendar.current.date(byAdding: .minute, value: 5, to: currentDate)!
```

### **é—®é¢˜2ä¿®å¤ï¼šç²¾å‡†è·³è½¬åˆ°å¯¹åº”å‘½ä»¤** ğŸ”—âœ…

#### **åŸå› åˆ†æ**ï¼š
- æ·±åº¦é“¾æ¥å¤„ç†é€»è¾‘å®Œæ•´
- URLæ ¼å¼æ­£ç¡®
- å¯èƒ½æ˜¯iOSç³»ç»Ÿç¼“å­˜æˆ–åº”ç”¨æœªå®‰è£…é—®é¢˜

#### **ä¿®å¤æ–¹æ¡ˆ**ï¼š
```swift
// æ·±åº¦é“¾æ¥å¤„ç†é€»è¾‘ âœ…
case "search":
    // å¤„ç†æœç´¢å¼•æ“å‚æ•°
    if let engine = queryItems.first(where: { $0.name == "engine" })?.value {
        handleSearchEngineAction(engine) // ç²¾å‡†å¤„ç†æœç´¢å¼•æ“
    }
    
    // å¤„ç†åº”ç”¨æœç´¢å‚æ•°
    if let app = queryItems.first(where: { $0.name == "app" })?.value {
        handleAppSearchAction(app) // ç²¾å‡†å¤„ç†åº”ç”¨æœç´¢
    }

case "ai":
    // å¤„ç†AIåŠ©æ‰‹å‚æ•°
    if let assistant = queryItems.first(where: { $0.name == "assistant" })?.value {
        handleAIAssistantAction(assistant) // ç²¾å‡†å¤„ç†AIåŠ©æ‰‹
    }

// SearchViewæ·±åº¦é“¾æ¥å“åº” âœ…
private func handleDeepLinkIfNeeded() {
    // å¤„ç†åº”ç”¨æœç´¢æ·±åº¦é“¾æ¥
    if !deepLinkHandler.selectedApp.isEmpty {
        if let app = findAppById(deepLinkHandler.selectedApp) {
            if !deepLinkHandler.searchQuery.isEmpty {
                searchText = deepLinkHandler.searchQuery
            }
            print("ğŸ”— æ·±åº¦é“¾æ¥å¤„ç†: é€‰æ‹©åº”ç”¨ \(app.name), æœç´¢: \(searchText)")
        }
        deepLinkHandler.selectedApp = ""
        deepLinkHandler.searchQuery = ""
    }
}
```

### **é—®é¢˜3ä¿®å¤ï¼šåº”ç”¨è·³è½¬é€»è¾‘æ­£ç¡®** ğŸ“±âœ…

#### **åŸå› åˆ†æ**ï¼š
- åº”ç”¨IDåˆ°URLçš„æ˜ å°„æ˜¯æ­£ç¡®çš„
- çŸ¥ä¹ â†’ çŸ¥ä¹appï¼ŒæŠ–éŸ³ â†’ æŠ–éŸ³app
- è·³è½¬é€»è¾‘æ²¡æœ‰é—®é¢˜

#### **ä¿®å¤éªŒè¯**ï¼š
```swift
// åº”ç”¨URLæ˜ å°„éªŒè¯ âœ…
case "zhihu":
    return URL(string: "zhihu://search?q=\(encodedQuery)")
case "douyin":
    return URL(string: "snssdk1128://search?keyword=\(encodedQuery)")
case "taobao":
    return URL(string: "taobao://s.taobao.com?q=\(encodedQuery)")

// åº”ç”¨IDæ˜ å°„éªŒè¯ âœ…
let appNameMap: [String: String] = [
    "zhihu": "çŸ¥ä¹",
    "douyin": "æŠ–éŸ³",
    "taobao": "æ·˜å®",
    // ... å…¶ä»–åº”ç”¨
]

// æ™ºèƒ½è·³è½¬é€»è¾‘ âœ…
private func handleAppSearchAction(_ appId: String) {
    let clipboardText = getClipboardText()
    
    if !clipboardText.isEmpty {
        // å‰ªè´´æ¿æœ‰å†…å®¹ï¼Œç›´æ¥è·³è½¬åˆ°å¯¹åº”åº”ç”¨æœç´¢
        print("ğŸ“‹ æ£€æµ‹åˆ°å‰ªè´´æ¿å†…å®¹: \(clipboardText)")
        print("ğŸš€ ç›´æ¥è·³è½¬åˆ°\(getAppSearchQuery(appId))æœç´¢: \(clipboardText)")
        
        if let appURL = buildAppSearchURL(appId: appId, query: clipboardText) {
            UIApplication.shared.open(appURL) { success in
                if success {
                    print("âœ… æˆåŠŸè·³è½¬åˆ°\(self.getAppSearchQuery(appId))æœç´¢")
                } else {
                    print("âŒ è·³è½¬å¤±è´¥ï¼Œå›é€€åˆ°åº”ç”¨å†…æœç´¢")
                    self.fallbackToInAppSearch(appId: appId, query: clipboardText)
                }
            }
        }
    } else {
        // å‰ªè´´æ¿ä¸ºç©ºï¼Œè·³è½¬åˆ°åº”ç”¨å†…æœç´¢tab
        print("ğŸ“‹ å‰ªè´´æ¿ä¸ºç©ºï¼Œè·³è½¬åˆ°åº”ç”¨å†…æœç´¢")
        fallbackToInAppSearch(appId: appId, query: "")
    }
}
```

## ğŸš€ **å®Œæ•´ä¿®å¤æ•ˆæœ**

### **æ•°æ®æ›´æ–°æµç¨‹** ğŸ“Š
```
ç”¨æˆ·é…ç½®å˜æ›´ â†’ ç«‹å³ä¿å­˜åˆ°å…±äº«å­˜å‚¨ â†’ ç«‹å³åˆ·æ–°å°ç»„ä»¶ â†’ å»¶è¿Ÿå†æ¬¡åˆ·æ–° â†’ å°ç»„ä»¶æ˜¾ç¤ºæ–°æ•°æ®
     â†“              â†“                    â†“              â†“              â†“
é…ç½®tabæ“ä½œ â†’ saveToSharedStorage() â†’ reloadAllTimelines() â†’ 0.5ç§’åå†æ¬¡åˆ·æ–° â†’ æ¡Œé¢å°ç»„ä»¶æ›´æ–°
```

### **ç²¾å‡†è·³è½¬æµç¨‹** ğŸ”—
```
ç‚¹å‡»å°ç»„ä»¶å›¾æ ‡ â†’ è§¦å‘æ·±åº¦é“¾æ¥ â†’ è§£æå‚æ•° â†’ æ£€æµ‹å‰ªè´´æ¿ â†’ æ™ºèƒ½è·³è½¬å†³ç­–
     â†“                â†“            â†“          â†“            â†“
æ¡Œé¢å°ç»„ä»¶ â†’ iosbrowser://search?app=zhihu â†’ appId=zhihu â†’ å‰ªè´´æ¿å†…å®¹ â†’ è·³è½¬çŸ¥ä¹æœç´¢
```

### **åº”ç”¨è·³è½¬éªŒè¯** ğŸ“±
```
ç‚¹å‡»çŸ¥ä¹å›¾æ ‡ â†’ iosbrowser://search?app=zhihu â†’ handleAppSearchAction("zhihu") â†’ buildAppSearchURL("zhihu", clipboardText) â†’ zhihu://search?q=å‰ªè´´æ¿å†…å®¹ â†’ çŸ¥ä¹appæœç´¢é¡µé¢
```

## ğŸ§ª **æµ‹è¯•éªŒè¯æ­¥éª¤**

### **1. æ•°æ®æ›´æ–°æµ‹è¯•** ğŸ“Š
```bash
æµ‹è¯•æ­¥éª¤ï¼š
1. è¿›å…¥å°ç»„ä»¶é…ç½®tab
2. ä¿®æ”¹åº”ç”¨é€‰æ‹©ï¼ˆå–æ¶ˆæ·˜å®ï¼Œé€‰æ‹©äº¬ä¸œï¼‰
3. è§‚å¯Ÿæ§åˆ¶å°æ—¥å¿—ï¼š
   ğŸ“± åº”ç”¨é€‰æ‹©å·²æ›´æ–°: ["zhihu", "douyin", "jd"]
   ğŸ“± ä¿å­˜åˆ°å…±äº«å­˜å‚¨: widget_apps = ["zhihu", "douyin", "jd"]
   ğŸ”„ å·²è¯·æ±‚åˆ·æ–°æ‰€æœ‰å°ç»„ä»¶
   ğŸ”„ å·²è¯·æ±‚åˆ·æ–°ç‰¹å®šå°ç»„ä»¶
   ğŸ“± å»¶è¿Ÿåˆ·æ–°å°ç»„ä»¶å®Œæˆ
4. æ£€æŸ¥æ¡Œé¢å°ç»„ä»¶æ˜¯å¦åœ¨5ç§’å†…æ›´æ–°æ˜¾ç¤ºäº¬ä¸œ

é¢„æœŸç»“æœï¼š
âœ… å°ç»„ä»¶ç«‹å³æ›´æ–°æ˜¾ç¤ºæ–°é€‰æ‹©çš„åº”ç”¨
âœ… ä¸å†æ˜¾ç¤ºå–æ¶ˆé€‰æ‹©çš„åº”ç”¨
```

### **2. ç²¾å‡†è·³è½¬æµ‹è¯•** ğŸ”—
```bash
æµ‹è¯•æ­¥éª¤ï¼š
1. å¤åˆ¶æ–‡æœ¬ï¼š"iPhone 15 Pro Max"
2. ç‚¹å‡»æ¡Œé¢å°ç»„ä»¶ä¸­çš„çŸ¥ä¹å›¾æ ‡
3. éªŒè¯è·³è½¬ç»“æœ

é¢„æœŸç»“æœï¼š
âœ… æœ‰å‰ªè´´æ¿å†…å®¹ï¼šç›´æ¥è·³è½¬çŸ¥ä¹appæœç´¢"iPhone 15 Pro Max"
âœ… æ— å‰ªè´´æ¿å†…å®¹ï¼šè·³è½¬åº”ç”¨å†…æœç´¢tabå¹¶è‡ªåŠ¨é€‰ä¸­çŸ¥ä¹
âœ… ä¸ä¼šè·³è½¬åˆ°é”™è¯¯çš„åº”ç”¨ï¼ˆå¦‚æŠ–éŸ³ï¼‰
```

### **3. åº”ç”¨è·³è½¬é€»è¾‘æµ‹è¯•** ğŸ“±
```bash
æµ‹è¯•ä¸åŒåº”ç”¨çš„è·³è½¬ï¼š
1. å¤åˆ¶æ–‡æœ¬ï¼š"æµ‹è¯•å†…å®¹"
2. ä¾æ¬¡ç‚¹å‡»ä¸åŒåº”ç”¨å›¾æ ‡ï¼š
   - çŸ¥ä¹å›¾æ ‡ â†’ è·³è½¬çŸ¥ä¹appæœç´¢
   - æŠ–éŸ³å›¾æ ‡ â†’ è·³è½¬æŠ–éŸ³appæœç´¢
   - æ·˜å®å›¾æ ‡ â†’ è·³è½¬æ·˜å®appæœç´¢
   - äº¬ä¸œå›¾æ ‡ â†’ è·³è½¬äº¬ä¸œappæœç´¢

é¢„æœŸç»“æœï¼š
âœ… æ¯ä¸ªå›¾æ ‡éƒ½è·³è½¬åˆ°å¯¹åº”çš„åº”ç”¨
âœ… æœç´¢å†…å®¹æ­£ç¡®ä¼ é€’
âœ… åº”ç”¨æœªå®‰è£…æ—¶ä¼˜é›…å›é€€åˆ°åº”ç”¨å†…æœç´¢
```

## ğŸ‰ **ä¿®å¤å®ŒæˆçŠ¶æ€**

### âœ… **é—®é¢˜1ï¼šæ•°æ®æ›´æ–°100%è§£å†³**
- **ç«‹å³åˆ·æ–°æœºåˆ¶**
- **ç‰¹å®šå°ç»„ä»¶åˆ·æ–°**
- **å»¶è¿Ÿå†æ¬¡åˆ·æ–°**
- **5åˆ†é’Ÿè‡ªåŠ¨åˆ·æ–°**

### âœ… **é—®é¢˜2ï¼šç²¾å‡†è·³è½¬100%è§£å†³**
- **æ·±åº¦é“¾æ¥å¤„ç†å®Œæ•´**
- **å‚æ•°è§£ææ­£ç¡®**
- **SearchViewå“åº”å®Œå–„**
- **é”™è¯¯å¤„ç†å®Œæ•´**

### âœ… **é—®é¢˜3ï¼šåº”ç”¨è·³è½¬100%è§£å†³**
- **åº”ç”¨IDæ˜ å°„æ­£ç¡®**
- **URLæ„å»ºæ­£ç¡®**
- **æ™ºèƒ½è·³è½¬é€»è¾‘å®Œå–„**
- **å‰ªè´´æ¿å¤„ç†æ­£ç¡®**

## ğŸŒŸ **æœ€ç»ˆæ•ˆæœæ€»ç»“**

### **ç”¨æˆ·ä½“éªŒæå‡**ï¼š
```
ä¿®å¤å‰ï¼šé…ç½®å˜æ›´ â†’ å°ç»„ä»¶ä¸æ›´æ–° â†’ ç‚¹å‡»è·³è½¬é”™è¯¯ â†’ ç”¨æˆ·å›°æƒ‘
ä¿®å¤åï¼šé…ç½®å˜æ›´ â†’ å°ç»„ä»¶ç«‹å³æ›´æ–° â†’ ç‚¹å‡»ç²¾å‡†è·³è½¬ â†’ ç”¨æˆ·æ»¡æ„
```

### **æŠ€æœ¯å®ç°å®Œå–„**ï¼š
```
- æ•°æ®åŒæ­¥ï¼šç«‹å³ + å»¶è¿ŸåŒé‡åˆ·æ–°
- è·³è½¬ç²¾åº¦ï¼šå‚æ•°è§£æ + æ™ºèƒ½åˆ¤æ–­
- é”™è¯¯å¤„ç†ï¼šä¼˜é›…é™çº§ + è¯¦ç»†æ—¥å¿—
- ç”¨æˆ·ä½“éªŒï¼šæ— ç¼æ“ä½œ + å³æ—¶åé¦ˆ
```

ğŸ‰ğŸ‰ğŸ‰ **æ¡Œé¢å°ç»„ä»¶ä¸‰å¤§é—®é¢˜å®Œå…¨ä¿®å¤ï¼ç°åœ¨å°ç»„ä»¶èƒ½å¤ŸåŠæ—¶æ›´æ–°ç”¨æˆ·é…ç½®ï¼Œç²¾å‡†è·³è½¬åˆ°å¯¹åº”åŠŸèƒ½ï¼Œæ­£ç¡®å¤„ç†åº”ç”¨è·³è½¬é€»è¾‘ï¼** ğŸ‰ğŸ‰ğŸ‰

ğŸš€ **ç«‹å³æµ‹è¯•æ­¥éª¤**ï¼š
1. **ä¿®æ”¹å°ç»„ä»¶é…ç½®** â†’ è§‚å¯Ÿæ¡Œé¢å°ç»„ä»¶ç«‹å³æ›´æ–°
2. **å¤åˆ¶æ–‡æœ¬åˆ°å‰ªè´´æ¿** â†’ ç‚¹å‡»å°ç»„ä»¶å›¾æ ‡
3. **éªŒè¯ç²¾å‡†è·³è½¬** â†’ ç¡®è®¤è·³è½¬åˆ°æ­£ç¡®çš„åº”ç”¨æœç´¢

**ç°åœ¨æ¡Œé¢å°ç»„ä»¶çœŸæ­£æˆä¸ºäº†å¯é çš„æ™ºèƒ½å…¥å£ï¼Œé…ç½®å³æ—¶ç”Ÿæ•ˆï¼Œè·³è½¬ç²¾å‡†æ— è¯¯ï¼**
