# ğŸ¯ å°ç»„ä»¶æ•°æ®åŒæ­¥ç»ˆæè§£å†³æ–¹æ¡ˆ

## ğŸš¨ é—®é¢˜ç°çŠ¶
æ ¹æ®æœ€æ–°æ—¥å¿—ï¼Œå°ç»„ä»¶ä»ç„¶è¯»å–åˆ°ç©ºæ•°æ®ï¼š
```
ğŸ”§ [SimpleWidget] UserDefaults.standardè¯»å–ç»“æœ: iosbrowser_actions = []
ğŸ”§ [SimpleWidget] UserDefaults.standardè¯»å–ç»“æœ: iosbrowser_engines = []
ğŸ”§ [SimpleWidget] UserDefaults.standardè¯»å–ç»“æœ: iosbrowser_apps = []
ğŸ”§ [SimpleWidget] UserDefaults.standardè¯»å–ç»“æœ: iosbrowser_ai = []
```

**æ ¹æœ¬é—®é¢˜**: ä¸»åº”ç”¨çš„æ•°æ®åˆå§‹åŒ–æ²¡æœ‰åœ¨å°ç»„ä»¶è¯»å–ä¹‹å‰å®Œæˆã€‚

## ğŸ”§ ç»ˆæè§£å†³æ–¹æ¡ˆ

### **æ ¸å¿ƒç­–ç•¥**: åº”ç”¨å¯åŠ¨æ—¶ç«‹å³åˆå§‹åŒ–
å°†æ•°æ®åˆå§‹åŒ–æå‰åˆ°åº”ç”¨å¯åŠ¨çš„æœ€æ—©æ—¶æœºï¼Œç¡®ä¿å°ç»„ä»¶éšæ—¶éƒ½èƒ½è¯»å–åˆ°æ•°æ®ã€‚

### **å®æ–½æ–¹æ¡ˆ**

#### 1. **åœ¨ContentView.onAppearä¸­ç«‹å³åˆå§‹åŒ–**
```swift
.onAppear {
    // ğŸ”¥ğŸ”¥ğŸ”¥ åº”ç”¨å¯åŠ¨æ—¶ç«‹å³åˆå§‹åŒ–å°ç»„ä»¶æ•°æ®
    initializeWidgetDataOnAppStart()
}
```

#### 2. **ä¸“é—¨çš„å¯åŠ¨åˆå§‹åŒ–æ–¹æ³•**
```swift
private func initializeWidgetDataOnAppStart() {
    print("ğŸš€ğŸš€ğŸš€ åº”ç”¨å¯åŠ¨æ—¶åˆå§‹åŒ–å°ç»„ä»¶æ•°æ®...")
    
    let defaults = UserDefaults.standard
    var needsSync = false
    
    // æ£€æŸ¥å¹¶åˆå§‹åŒ–æ‰€æœ‰æ•°æ®ç±»å‹
    if defaults.stringArray(forKey: "iosbrowser_engines")?.isEmpty != false {
        defaults.set(["baidu", "google"], forKey: "iosbrowser_engines")
        needsSync = true
    }
    
    if defaults.stringArray(forKey: "iosbrowser_apps")?.isEmpty != false {
        defaults.set(["taobao", "zhihu", "douyin"], forKey: "iosbrowser_apps")
        needsSync = true
    }
    
    if defaults.stringArray(forKey: "iosbrowser_ai")?.isEmpty != false {
        defaults.set(["deepseek", "qwen"], forKey: "iosbrowser_ai")
        needsSync = true
    }
    
    if defaults.stringArray(forKey: "iosbrowser_actions")?.isEmpty != false {
        defaults.set(["search", "bookmark"], forKey: "iosbrowser_actions")
        needsSync = true
    }
    
    if needsSync {
        defaults.synchronize()
        // å»¶è¿Ÿåˆ·æ–°å°ç»„ä»¶
        DispatchQueue.main.asyncAfter(deadline: .now() + 1.0) {
            WidgetCenter.shared.reloadAllTimelines()
        }
    }
}
```

## ğŸ›¡ï¸ å¤šé‡ä¿éšœæœºåˆ¶

### **ç¬¬ä¸€é“é˜²çº¿**: åº”ç”¨å¯åŠ¨æ—¶åˆå§‹åŒ–
- âœ… åœ¨ContentView.onAppearä¸­ç«‹å³æ£€æŸ¥å’Œåˆå§‹åŒ–
- âœ… ä¸ä¾èµ–ç”¨æˆ·æ“ä½œ
- âœ… åº”ç”¨å¯åŠ¨å°±å®Œæˆæ•°æ®å‡†å¤‡

### **ç¬¬äºŒé“é˜²çº¿**: @Publishedå˜é‡åˆå§‹åŒ–
- âœ… åœ¨DataSyncCenteråˆ›å»ºæ—¶ä¿å­˜é»˜è®¤æ•°æ®
- âœ… ä½œä¸ºå¤‡ç”¨ä¿éšœæœºåˆ¶

### **ç¬¬ä¸‰é“é˜²çº¿**: å°ç»„ä»¶é…ç½®é¡µé¢å¼ºåˆ¶åˆå§‹åŒ–
- âœ… ç”¨æˆ·è¿›å…¥é…ç½®é¡µé¢æ—¶å†æ¬¡æ£€æŸ¥
- âœ… ç¡®ä¿é…ç½®æ“ä½œçš„å¯é æ€§

### **ç¬¬å››é“é˜²çº¿**: å°ç»„ä»¶æ™ºèƒ½é»˜è®¤æ•°æ®
- âœ… å°ç»„ä»¶è¯»å–å¤±è´¥æ—¶ä½¿ç”¨åˆç†é»˜è®¤å€¼
- âœ… ä¸ä¸»åº”ç”¨ä¿æŒä¸€è‡´

## ğŸš€ æ•°æ®æµå‘ä¼˜åŒ–

### **ä¿®å¤å‰çš„é—®é¢˜æµå‘**
```
åº”ç”¨å¯åŠ¨ â†’ ç”¨æˆ·å¯èƒ½ä¸è¿›å…¥é…ç½®é¡µé¢ â†’ @Publishedå¯èƒ½ä¸åˆå§‹åŒ– â†’ 
UserDefaultsä¸ºç©º â†’ å°ç»„ä»¶è¯»å–ç©ºæ•°æ® â†’ ä½¿ç”¨æµ‹è¯•æ•°æ®
```

### **ä¿®å¤åçš„æ­£ç¡®æµå‘**
```
åº”ç”¨å¯åŠ¨ â†’ ContentView.onAppear â†’ initializeWidgetDataOnAppStart() â†’ 
æ£€æŸ¥UserDefaults â†’ ä¿å­˜é»˜è®¤æ•°æ® â†’ åŒæ­¥ â†’ åˆ·æ–°å°ç»„ä»¶ â†’ 
å°ç»„ä»¶è¯»å–æ­£ç¡®æ•°æ®
```

## ğŸ“± æµ‹è¯•éªŒè¯

### **æµ‹è¯•æ­¥éª¤**
1. **åˆ é™¤åº”ç”¨**ï¼ˆæ¸…é™¤æ‰€æœ‰æ•°æ®ï¼‰
2. **é‡æ–°å®‰è£…å¹¶å¯åŠ¨åº”ç”¨**
3. **è§‚å¯Ÿæ§åˆ¶å°æ—¥å¿—**ï¼Œåº”è¯¥çœ‹åˆ°ï¼š
   ```
   ğŸš€ğŸš€ğŸš€ åº”ç”¨å¯åŠ¨æ—¶åˆå§‹åŒ–å°ç»„ä»¶æ•°æ®...
   ğŸš€ åº”ç”¨å¯åŠ¨åˆå§‹åŒ–: ä¿å­˜é»˜è®¤æœç´¢å¼•æ“ ["baidu", "google"]
   ğŸš€ åº”ç”¨å¯åŠ¨åˆå§‹åŒ–: ä¿å­˜é»˜è®¤åº”ç”¨ ["taobao", "zhihu", "douyin"]
   ğŸš€ åº”ç”¨å¯åŠ¨åˆå§‹åŒ–: ä¿å­˜é»˜è®¤AIåŠ©æ‰‹ ["deepseek", "qwen"]
   ğŸš€ åº”ç”¨å¯åŠ¨åˆå§‹åŒ–: ä¿å­˜é»˜è®¤å¿«æ·æ“ä½œ ["search", "bookmark"]
   ğŸš€ åº”ç”¨å¯åŠ¨åˆå§‹åŒ–: UserDefaultsåŒæ­¥ç»“æœ true
   ğŸš€ğŸš€ğŸš€ åº”ç”¨å¯åŠ¨åˆå§‹åŒ–å®Œæˆï¼Œå·²ä¿å­˜é»˜è®¤æ•°æ®
   ```
4. **æ·»åŠ å°ç»„ä»¶**ï¼Œåº”è¯¥çœ‹åˆ°ï¼š
   ```
   ğŸ”§ [SimpleWidget] UserDefaults.standardè¯»å–ç»“æœ: iosbrowser_actions = ["search", "bookmark"]
   ğŸ”§ [SimpleWidget] âœ… UserDefaultsè¯»å–æˆåŠŸ: ["search", "bookmark"]
   ```

### **é¢„æœŸç»“æœ**
å°ç»„ä»¶åº”è¯¥æ˜¾ç¤ºï¼š
- **æœç´¢å¼•æ“**: ["baidu", "google"]
- **åº”ç”¨**: ["taobao", "zhihu", "douyin"]
- **AIåŠ©æ‰‹**: ["deepseek", "qwen"]
- **å¿«æ·æ“ä½œ**: ["search", "bookmark"]

## ğŸ¯ å…³é”®ä¼˜åŠ¿

### **è§£å†³æ—¶æœºé—®é¢˜**
- âœ… ä¸å†ä¾èµ–ç”¨æˆ·è¿›å…¥é…ç½®é¡µé¢
- âœ… åº”ç”¨å¯åŠ¨æ—¶å°±å®Œæˆæ•°æ®å‡†å¤‡
- âœ… å°ç»„ä»¶éšæ—¶å¯ä»¥è¯»å–åˆ°æ•°æ®

### **è§£å†³ä¾èµ–é—®é¢˜**
- âœ… ä¸ä¾èµ–@Publishedå˜é‡çš„åˆå§‹åŒ–æ—¶æœº
- âœ… ä¸ä¾èµ–DataSyncCenterçš„åˆ›å»ºæ—¶æœº
- âœ… ç›´æ¥æ“ä½œUserDefaultsï¼Œæ›´å¯é 

### **æå‡ç”¨æˆ·ä½“éªŒ**
- âœ… å°ç»„ä»¶å§‹ç»ˆæ˜¾ç¤ºæœ‰æ„ä¹‰çš„æ•°æ®
- âœ… ä¸ä¸»åº”ç”¨æ•°æ®ä¿æŒä¸€è‡´
- âœ… ç”¨æˆ·æ“ä½œèƒ½å®æ—¶åæ˜ åˆ°å°ç»„ä»¶

## ğŸ”§ æŠ€æœ¯å®ç°ç»†èŠ‚

### **æ£€æŸ¥é€»è¾‘ä¼˜åŒ–**
```swift
// ä½¿ç”¨æ›´ä¸¥æ ¼çš„æ£€æŸ¥æ¡ä»¶
if defaults.stringArray(forKey: "iosbrowser_actions")?.isEmpty != false {
    // è¿™ä¸ªæ¡ä»¶åœ¨ä»¥ä¸‹æƒ…å†µè¿”å›trueï¼š
    // 1. é”®ä¸å­˜åœ¨ï¼ˆè¿”å›nilï¼‰
    // 2. é”®å­˜åœ¨ä½†å€¼ä¸ºç©ºæ•°ç»„
    // ç¡®ä¿ä»»ä½•æƒ…å†µä¸‹éƒ½ä¼šä¿å­˜é»˜è®¤æ•°æ®
}
```

### **åŒæ­¥ç­–ç•¥ä¼˜åŒ–**
```swift
// ç«‹å³åŒæ­¥ + å»¶è¿Ÿåˆ·æ–°
defaults.synchronize()
DispatchQueue.main.asyncAfter(deadline: .now() + 1.0) {
    WidgetCenter.shared.reloadAllTimelines()
}
```

## ğŸ‰ æ€»ç»“

è¿™ä¸ªç»ˆæè§£å†³æ–¹æ¡ˆé€šè¿‡å°†æ•°æ®åˆå§‹åŒ–æå‰åˆ°åº”ç”¨å¯åŠ¨æ—¶ï¼Œå½»åº•è§£å†³äº†å°ç»„ä»¶æ•°æ®åŒæ­¥çš„æ—¶æœºé—®é¢˜ï¼š

1. **ä¸»åŠ¨åˆå§‹åŒ–** - ä¸ç­‰å¾…ç”¨æˆ·æ“ä½œ
2. **å¤šé‡ä¿éšœ** - å››é“é˜²çº¿ç¡®ä¿å¯é æ€§
3. **å³æ—¶ç”Ÿæ•ˆ** - åº”ç”¨å¯åŠ¨å°±å®Œæˆæ•°æ®å‡†å¤‡
4. **ç”¨æˆ·å‹å¥½** - å°ç»„ä»¶å§‹ç»ˆæ˜¾ç¤ºæ­£ç¡®æ•°æ®

**ç°åœ¨å°ç»„ä»¶åº”è¯¥èƒ½å¤Ÿå®Œç¾åœ°ä»ä¸»åº”ç”¨çš„é…ç½®ä¸­è¯»å–æ•°æ®ï¼Œå®ç°çœŸæ­£çš„æ•°æ®è”åŠ¨ï¼** ğŸš€
